var Game;Game=function(){function a(){var a;this.interval=1/30*1e3,this.input=new Input,this.loader=new Loader,a=this,this.step_callback=function(){return a.step()},this.loader.loadComplete(function(){return a.start()})}return a.prototype.start=function(){return this.step()},a.prototype.step=function(){return console.log("Implement me!!!")},a.prototype.next=function(){return window.setTimeout(this.step_callback,this.interval)},a}();var Loader;Loader=function(){function a(){this.progress=0,this.assets={},this.totalAssets=0,this.loadedAssets=0}return a.prototype.updateProgress=function(){this.progress=this.loadedAssets/this.totalAssets;if(this.progress===1&&this.onload)return this.onload()},a.prototype.load=function(a){var b,c,d;d=[];for(c in a)b=a[c],d.push(this.loadAsset(c,b));return d},a.prototype.loadAsset=function(a,b){var c,d;return c=new Image,d=this,c.onload=function(){return this.loaded=!0,d.loadedAssets++,d.updateProgress()},this.assets[a]={loader:this,src:b,image:c},this.totalAssets++,c.src=b},a.prototype.loadComplete=function(a){return this.onload=a},a.prototype.getAsset=function(a){return this.assets[a].image},a}();var Input;Input=function(){function a(){var a,b,c,d;this.keys={},d=this.keys,c=function(a){return a.which||(a.which=a.charCode),a.which||(a.which=a.keyCode),a},a=function(a){return d["key"+c(a).which]=!0},b=function(a){return d["key"+c(a).which]=!1},document.onkeydown=a,document.onkeyup=b,this.shortcuts={left:["key37","key65"],right:["key39","key68"],up:["key38","key87"],down:["key40","key83"]}}return a.prototype.left=function(a){return this.keys[this.shortcuts.left[a]]||!1},a.prototype.right=function(a){return this.keys[this.shortcuts.right[a]]||!1},a.prototype.up=function(a){return this.keys[this.shortcuts.up[a]]||!1},a.prototype.down=function(a){return this.keys[this.shortcuts.down[a]]||!1},a}();var World;World=function(){function a(a,b,c){var d;this.bg=c,this.canvas=document.getElementById(a),this.ctx=this.canvas.getContext("2d"),this.calculateDimensions(),this.ctx._world=this,d=new Box2D.Common.Math.b2Vec2(0,14),this.world=new Box2D.Dynamics.b2World(d,!0),this.sprites=[],this.interval=b/1e3}return a.prototype.calculateDimensions=function(){var a;return this.width=parseFloat(this.canvas.width),this.height=parseFloat(this.canvas.height),a=1.5,this.box2dWidth=10,this.box2dHeight=10*a,this.scaleWidth=this.width/this.box2dWidth,this.scaleHeight=this.height/this.box2dHeight},a.prototype.addStaticSprite=function(a){return this.sprites.push({sprite:a})},a.prototype.addSprite=function(a){var b;return b=this.world.CreateBody(a.body),b.CreateFixture(a.fixture),this.sprites.push({sprite:a,body:b})},a.prototype.draw=function(){var a,b,c,d,e;this.ctx.clearRect(0,0,this.box2dWidth,this.box2dHeight),d=this.sprites,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a.body&&a.sprite.updateBody(a.body,this),e.push(a.sprite.draw(this.ctx));return e},a.prototype.step=function(){return this.world.Step(this.interval,10,10),this.world.ClearForces()},a}();var Sprite;Sprite=function(){function a(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.createBody()}return a.prototype.createBody=function(){return this.body=null},a.prototype.updateBody=function(a,b){if(a)return this.x=a.GetPosition().x*(b.width/b.box2dWidth),this.y=a.GetPosition().y*(b.height/b.box2dHeight),this.m_body=a},a.prototype.draw=function(a){return console.log("Override me!")},a}();var Constants;Constants=function(){function a(){}return a.bottomHeight=.75,a}();var StretchySprite,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};StretchySprite=function(){function a(b,c,d,e,f,g,h){this.x=b,this.y=c,this.width=d,this.height=e,this.rightCap=f,this.topCap=g,this.bg=h,this.generateStretchedImage(),a.__super__.constructor.call(this,this.x,this.y,this.width,this.height)}return __extends(a,Sprite),a.prototype.generateStretchedImage=function(){var a,b,c,d,e,f,g,h;return a=function(a,b){var c;return c=document.createElement("canvas"),c.width=a,c.height=b,c},f=a(this.width,2),c=a(8,this.height),g=f.getContext("2d"),g.drawImage(this.bg,0,this.topCap,this.bg.width,1,0,0,this.width,f.height),d=c.getContext("2d"),d.drawImage(this.bg,this.bg.width-this.rightCap-c.width,0,c.width,this.bg.height,0,this.height-this.bg.height,c.width,this.bg.height),this.stretchedImage=a(this.width,this.height),b=this.stretchedImage.getContext("2d"),b.drawImage(this.bg,this.x,this.y+this.height-this.bg.height),e=b.createPattern(c,"repeat-x"),b.fillStyle=e,b.fillRect(this.bg.width-this.rightCap,this.height-this.bg.height,this.width-this.bg.width,this.bg.height),h=b.createPattern(f,"repeat-y"),b.fillStyle=h,b.fillRect(0,this.topCap,this.width,this.height-this.bg.height),b.drawImage(this.bg,0,0,this.bg.width,this.topCap,0,0,this.width,this.topCap),b.drawImage(this.bg,this.bg.width-this.rightCap,0,this.rightCap,this.bg.height,this.width-this.rightCap,this.height-this.bg.height,this.rightCap,this.bg.height)},a.prototype.draw=function(a){return a.drawImage(this.stretchedImage,0,0)},a}();var SlimeVolleyball,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};SlimeVolleyball=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Game),a.prototype.load=function(){return this.loader.load({p1:"assets/images/s_0.png",p2:"assets/images/s_1.png",bg:"assets/images/bg.png",ball:"assets/images/ball.png"})},a.prototype.start=function(){var b,c,d,e,f,g;this.world=new World("canvas",this.interval),this.bg=new StretchySprite(0,0,this.world.width,this.world.height,200,1,this.loader.getAsset("bg")),this.world.addStaticSprite(this.bg),this.p1=new Slime(2,4,"#0f0",this.loader.getAsset("p1")),this.p2=new Slime(5,4,"#00f",this.loader.getAsset("p2")),this.ball=new Ball(2,1,this.loader.getAsset("ball")),this.p1.ball=this.ball,this.p2.ball=this.ball,this.p2.isP2=!0,this.world.addSprite(this.p1),this.world.addSprite(this.p2),this.world.addSprite(this.ball),b=60*(this.world.box2dHeight/this.world.height),d=.2,e=[new Box(-d,0,d,this.world.box2dHeight),new Box(0,this.world.box2dHeight+d-b,this.world.box2dWidth,d),new Box(this.world.box2dWidth+d,0,d,this.world.box2dHeight),new Box(0,-d,this.world.box2dWidth,d)];for(f=0,g=e.length;f<g;f++)c=e[f],this.world.addSprite(c);return a.__super__.start.call(this)},a.prototype.step=function(){return this.p1.handleInput(this.input,this.world),this.p2.handleInput(this.input,this.world),this.world.draw(),this.world.step(),this.next()},a}(),window.onload=function(){var a;return a=new SlimeVolleyball,a.load()};var Slime,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Slime=function(){function a(b,c,d,e){this.x=b,this.y=c,this.color=d,this.img=e,this.radius=.3275,this.artSize=64,this.isP2=!1,a.__super__.constructor.call(this,this.x,this.y,this.radius*2,this.radius*2)}return __extends(a,Sprite),a.prototype.createBody=function(){return this.fixture=new Box2D.Dynamics.b2FixtureDef,this.fixture.density=1,this.fixture.friction=1,this.fixture.restitution=0,this.fixture.shape=new Box2D.Collision.Shapes.b2CircleShape(this.radius),this.body=new Box2D.Dynamics.b2BodyDef,this.body.type=Box2D.Dynamics.b2Body.b2_dynamicBody,this.body.position.Set(this.x,this.y)},a.prototype.handleInput=function(a,b){var c,d,e;console.log(this.radius*(b.width/b.box2dWidth)),this.m_body&&(e=b.box2dHeight-this.m_body.GetPosition().y),d=this.isP2?1:0,c=3,a.left(d)&&(this.m_body.m_linearVelocity.x=-4,this.m_body.SetAwake(!0)),a.right(d)&&(this.m_body.m_linearVelocity.x=4,this.m_body.SetAwake(!0)),a.up(d)&&e<c&&(this.m_body.m_linearVelocity.y=-7,this.m_body.SetAwake(!0));if(a.down(d)){if(this.m_body.m_linearVelocity.y>0&&e>c)return this.m_body.m_linearVelocity.y*=1.5}else if(this.m_body&&e<c)return this.m_body.m_linearVelocity.x/=1.1},a.prototype.draw=function(a){return a.translate(this.x,this.y),a.fillStyle="#000",a.fillRect(0,0,3,3),a.translate(-this.x,-this.y),a.translate(this.x-this.artSize/2,this.y-this.artSize/2),a.drawImage(this.img,0,0),a.translate(-this.x+this.artSize/2,-this.y+this.artSize/2)},a}();var Box,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Box=function(){function a(b,c,d,e){this.x=b,this.y=c,this.width=d,this.height=e,this.color="#444",a.__super__.constructor.apply(this,arguments)}return __extends(a,Sprite),a.prototype.createBody=function(){return this.fixture=new Box2D.Dynamics.b2FixtureDef,this.fixture.friction=1,this.fixture.restitution=0,this.fixture.shape=new Box2D.Collision.Shapes.b2PolygonShape,this.fixture.shape.SetAsBox(this.width,this.height),this.body=new Box2D.Dynamics.b2BodyDef,this.body.type=Box2D.Dynamics.b2Body.b2_staticBody,this.body.position.Set(this.x,this.y)},a.prototype.draw=function(a){},a}();var Ball,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Ball=function(){function a(b,c,d){this.x=b,this.y=c,this.bg=d,this.radius=.14,this.color="#000000",a.__super__.constructor.call(this,this.x,this.y,this.radius*2,this.radius*2)}return __extends(a,Sprite),a.prototype.createBody=function(){return this.fixture=new Box2D.Dynamics.b2FixtureDef,this.fixture.density=.4,this.fixture.friction=.5,this.fixture.restitution=.2,this.fixture.shape=new Box2D.Collision.Shapes.b2CircleShape(this.radius),this.body=new Box2D.Dynamics.b2BodyDef,this.body.type=Box2D.Dynamics.b2Body.b2_dynamicBody,this.body.position.Set(this.x,this.y)},a.prototype.draw=function(a){return console.log(.14*(a._world.width/a._world.box2dWidth)),a.fillStyle=this.color,a.beginPath(),a.arc(this.x,this.y,13,0,Math.PI*2,!0),a.closePath(),a.fill()},a}()